{% extends 'base.html' %}
{% block content %}
    <div class="col-md-8">
{#        <form action="{% url 'home' %}" method="get">#}
{#            <input name="home" value="Home" type="submit">#}
{#        </form>#}
        <h3>Searching for bonds that are similar to {{ sec_id }}, which characteristics is as follows</h3>
        <table class="table table-striped">
        <thead>
            <tr>
                {% for d in display_columns %}
                    <th class="table"> {{ d }} </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for b in bond_table %}
                <tr>
                    {% for bb in b %}
                        {% if bb == b.0 %}
{#                            <td><a href="javascript:drawGraph1('{{ bb }}')">{{ bb }}</a></td>#}
                            <td><a href="javascript:drawGraph1('{{ bb }}')">{{ bb }}</a></td>
                        {% else %}
                            <td> {{ bb }} </td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
        </table><br>
        <h3>The List of Similar Bonds for {{ sec_id }} is:</h3>
        <table class="table table-striped">
        <thead>
            <tr>
                {% for d in display_columns %}
                    <th> {{ d }} </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for s in similar_bonds_table %}
                <tr>
                    {% for ss in s %}
                        {% if ss == s.0 %}
                            <td><a href="javascript:drawGraph('{{ ss }}')">{{ ss }}</a></td>
                        {% else %}
                            <td> {{ ss }} </td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
        </table>
        {% for b in bond_OAS2 %}
            <input type="hidden" id="{{ b.0 }}" name="variable" value="{{ b.1 }}">
        {% endfor %}
        <table class="table table-striped">
        <thead>
{% comment %}            <tr>
                {% for b in bond_OAS2 %}
                    <th>{{ b.0 }}</th>
                    <th>{{ b.1 }}</th>
                {% endfor %}
            </tr>{% endcomment %}
        </thead>
        <tbody>
            <tr>
                {% for b in bond_OAS2 %}
                    <td>{{ b }}</td>
                    <td>{{ b }}</td>
                {% endfor %}
            </tr>
        </tbody>
        </table>
{#    <table class="table table-striped">#}
{#        <tbody>#}
{#            <td> {{ bond_dates }} </td>#}
{#            <td> {{ bond_OAS }} </td>#}
{#        </tbody>#}
{#        </table>#}
    </div>
    <div class="col-sm-offset-1 col-md-3">
        </br>
        <canvas id="myChart" width="300px" height="400px"></canvas>
{#        <canvas id="graph" width="400px" hight="400px"></canvas>#}
{#        <img src="/results/charts/view_plot_oas.png" alt="">#}
    </div>
    <script>
        var drawGraph1 = function(isin_code) {
            var labels1 = "{{ bond_dates|safe }}";
            var labels1 = labels1.split("|");
            var data1 = "{{ bond_OAS|safe }}";
            var data1 = data1.split("|").map(parseFloat);
            var label1 = isin_code;
            new Chart(document.getElementById("myChart"), {
                type: "line",
                data: {
                    labels: labels1,
                    datasets: [
                        {
                            label: label1,
                            data: data1,
                            borderColor: "rgb(185, 217, 235)",
                            fill: false
                        }
                    ]
                },
                options: {
                    title: {
                        display: true,
                        text: 'OAS spread: ' + String(label1),
                        fontSize: 16
                    }
                }
            });
        };
        var drawGraph = function(isin_code) {
            var labels1 = "{{ bond_dates|safe }}";
            var labels1 = labels1.split("|");
            var data1 = "{{ bond_OAS|safe }}";
            var data1 = data1.split("|").map(parseFloat);
            var data2 = "{{ bond_OAS2|safe }}";
            var data2 = data2.split("|").map(parseFloat);
            var label1 = "{{ sec_id }}";
            var label2 = isin_code;
            new Chart(document.getElementById("myChart"), {
                type: "line",
                data: {
                    labels: labels1,
                    datasets: [
                        {
                            label: label1,
                            data: data1,
                            borderColor: "rgb(185, 217, 235)",
                            fill: false
                        },
                        {
                            label: label2,
                            data: data2,
                            borderColor: "rgb(162, 10, 53)",
                            fill: false
                        }
                    ],
                },
                options: {
                    title: {
                        display: true,
                        text: 'OAS spread: ' + String(label1) + ' vs ' + String(label2),
                        fontSize: 16
                    }
                }
            });
        };
    </script>
{% endblock %}